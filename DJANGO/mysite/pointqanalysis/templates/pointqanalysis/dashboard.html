{% extends 'pointqanalysis/template_skeleton.html' %}
{% load staticfiles %}
{% block title %} Dashboard {% endblock %}


{% block container %} 
	<div id="step1">
		<div id='left_tree' style="height: 600px">
			<h2>Network Occupancy</h2>
			<h3>Controls</h3>
			<button type="button" class="btn btn-default play">Play</button>
			<button type="button" class="btn btn-default pause">Pause</button>
			<button type="button" class="btn btn-default restart">Restart</button><br /><br />
			<div class="btn-group" data-toggle="buttons">
				<label class="btn btn-default radio_speed">
					<input type="radio" id="radio_s1" autocomplete="off" > X1
				</label>
				<label class="btn btn-default active radio_speed">
					<input type="radio" id="radio_s2" autocomplete="off" checked> X10
				</label>
				<label class="btn btn-default radio_speed">
					<input type="radio" id="radio_s3" autocomplete="off"> X100
				</label>
			</div>
			<h3>Set Time Origin</h3>
			<form class="form-inline time_origin" style="display: inline-block">
				<div class="input-group">
					<input type="text" class="form-control" id="set_origin_h" placeholder="hh" style="width:45px">
					<div class="input-group-addon">h</div>
				</div>
				<div class="input-group">
					<input type="text" class="form-control" id="set_origin_m" placeholder="mm" style="width:45px">
					<div class="input-group-addon">m</div>
				</div>
				<div class="input-group">
					<input type="text" class="form-control" id="set_origin_s" placeholder="ss" style="width:45px">
					<div class="input-group-addon">s</div>
				</div>
			</form>
			<button type="text" class="btn btn-primary set_time_origin">Set</button>

			<h3>Jump to: </h3>
			<p><b>End Time</b> = <span id='end_time'> 00h00min00s </span></p> 
			<form class="form-inline jump" style="display: inline-block">
				<div class="input-group">
					<input type="text" class="form-control" id="field_time_simu_h" placeholder="hh" style="width:45px">
					<div class="input-group-addon">h</div>
				</div>
				<div class="input-group">
					<input type="text" class="form-control" id="field_time_simu_m" placeholder="mm" style="width:45px">
					<div class="input-group-addon">m</div>
				</div>
				<div class="input-group">
					<input type="text" class="form-control" id="field_time_simu_s" placeholder="ss" style="width:45px">
					<div class="input-group-addon">s</div>
				</div>
			</form>
			<button type="text" class="btn btn-primary btn-jump">Jump</button>

			<h3>Legend: </h3>
			<p>Occupancy [%]</p>
			<img src="{% static 'pointqanalysis/images/gradient.png' %}" style="opacity: 0.8"/>
		</div>
		<div id="map-container">
			<div class="loader">Loading...</div>
			<div id="time-display"></div>
			<div id="map-canvas" style='width: 100%; height: 520px'></div>
			<div id="nanobar"></div>
		</div>
	</div>

{% endblock %}

{% block javascript %} 
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=drawing,places"> </script>
    <!-- Import WebGL Layer and Dependencies. -->
    <script src="{% static 'pointqanalysis/js/gmapsCanvas/CanvasLayer.js' %}"></script>
    <script src="{% static 'pointqanalysis/js/gmapsCanvas/ShaderProgram.js' %}"></script>
    <script src="{% static 'pointqanalysis/js/gmapsCanvas/libtess.cat.js' %}"></script>
    <script src="{% static 'pointqanalysis/js/gmapsCanvas/WebGLLayer.js' %}"></script>
    <script type="text/javascript"  src="{% static 'pointqanalysis/js/v3_epoly.js' %}"></script>

	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript"  src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script type="text/javascript"  src="{% static 'pointqanalysis/js/nanobar.min.js' %}"></script>
	<script type="text/javascript"  src="http://momentjs.com/downloads/moment.min.js"></script>


	<script type="text/javascript"  src="{% static 'pointqanalysis/js/dashboard.map.js' %}"></script>
	<script type="text/javascript"  src="{% static 'pointqanalysis/js/dashboard.interface.js' %}"></script>
	<script type="text/javascript"  src="{% static 'pointqanalysis/js/dashboard.animation.js' %}"></script>
	<script type="text/javascript">

		// GLOBAL VARIABLES
		var geojson = JSON.parse('{{ geojson|safe}}');
		var node_marker = '{% static 'pointqanalysis/images/marker_dashboard.png' %}';
		var sim_name = '{{ sim_name }}';
		var maxtimesim = parseInt({{ maxtimesim }});

		var history_vehicle, map, dash_int, json_birdeye;

		$.getJSON( "../pointqanalysis/ajax?action=bird_traj", function( data ) {
			$('.loader').remove();
			history_vehicle  = data.vehicles;
			json_birdeye = data.occupation;

			if (history_vehicle && json_birdeye) {
				map = new GMAP('map-canvas', geojson, node_marker);
				dash_int = new dash_interface({"maxtimesim": maxtimesim});

				birdeye.init();
			}
			else {
				$('#step1').empty();
				$('#step1').append('<h1> The data for this analysis isn\'t ready yet, please come back in few minutes');
			}
		});



	</script>


{% endblock %}
